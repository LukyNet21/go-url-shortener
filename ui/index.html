<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Shortener</title>
</head>
<body>
    <section>
        <h2>Create new url</h2>
        <form id="new-url-form">
            <input type="text" name="url" placeholder="Enter URL">
            <button type="submit">Shorten</button>
        </form>
        <p id="new-url-content"></p>
    </section>
    <section>
        <h2>Delete</h2>
        <form id="delete-url-form">
            <input type="text" name="id" placeholder="Enter ID">
            <button type="submit">Delete</button>
        </form>
        <p id="delete-url-content"></p>
    </section>
    <script>
        const form = document.getElementById('new-url-form');
        const content = document.getElementById('new-url-content');
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const url = form.url.value;
            fetch("http://localhost:8080/shorten", {
                method: "POST",
                body: JSON.stringify({
                    url: url
                }),
                headers: {
                    "Content-type": "application/json; charset=UTF-8"
                }
            }).then((response) => {
                return response.json();
            }).then((data) => {
                content.innerHTML = `Your shortened URL is: <a href="http://localhost:8080/${data.shortUrl}" target="_blank">http://localhost:8080/${data.shortUrl}</a>, <br>and your id is '${data.id}' (save this for future url deletion)`
                form.url.value = ""
            }).catch((err) => {
                console.log(err);
            })

        })

        const deleteForm = document.getElementById('delete-url-form');
        const deleteContent = document.getElementById('delete-url-content');
        deleteForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const id = deleteForm.id.value;
            //request localhost:8080/delete/{id} with method delete if status 200 then show message
            fetch(`http://localhost:8080/delete/${id}`, {
                method: "DELETE",
                headers: {
                    "Content-type": "application/json; charset=UTF-8"
                }
            }).then((data) => {
                deleteContent.innerHTML = `Your url with id ${id} was deleted`
                deleteForm.id.value = ""
            })
        })

    </script>
</body>
</html>